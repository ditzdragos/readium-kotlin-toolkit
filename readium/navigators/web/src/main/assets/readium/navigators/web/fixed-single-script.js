!function(){"use strict";class t{constructor(t,e,i){if(this.margins={top:0,right:0,bottom:0,left:0},this.channel=new MessageChannel,!e.contentWindow)throw Error("Iframe argument must have been attached to DOM.");this.listener=i,this.iframe=e,this.iframe.addEventListener("load",(()=>{this.onIframeLoaded()}))}show(){this.iframe.style.display="unset"}hide(){this.iframe.style.display="none"}setMargins(t){this.margins!=t&&(this.iframe.style.marginTop=this.margins.top+"px",this.iframe.style.marginLeft=this.margins.left+"px",this.iframe.style.marginBottom=this.margins.bottom+"px",this.iframe.style.marginRight=this.margins.right+"px")}loadPage(t){this.iframe.src=t}setPlaceholder(t){this.iframe.style.width=t.width+"px",this.iframe.style.height=t.height+"px",this.size=t}onIframeLoaded(){const t=this.iframe.contentWindow.document.querySelector("meta[name=viewport]");if(!t||t instanceof HTMLMetaElement)return;const e=this.parsePageSize(t);e&&(this.iframe.style.width=e.width+"px",this.iframe.style.height=e.height+"px",this.size=e,this.channel.port1.onmessage=t=>{console.log(`onmessage ${t}`),this.onMessageFromIframe(t)},this.iframe.contentWindow.postMessage("Init","*",[this.channel.port2]),this.listener.onIframeLoaded())}onMessageFromIframe(t){t.data.x&&t.data.y?this.listener.onTap({x:t.data.x,y:t.data.y}):t.data.href&&this.listener.onLinkActivated(t.data.href)}parsePageSize(t){const e=/(\w+) *= *([^\s,]+)/g,i=new Map;let s;for(;s=e.exec(t.content);)null!=s&&i.set(s[1],s[2]);const n=parseFloat(i.get("width")),o=parseFloat(i.get("height"));return n&&o?{width:n,height:o}:void 0}}class e{setInitialScale(t){return this.initialScale=t,this}setMinimumScale(t){return this.minimumScale=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}build(){const t=[];return this.initialScale&&t.push("initial-scale="+this.initialScale),this.minimumScale&&t.push("minimum-scale="+this.minimumScale),this.width&&t.push("width="+this.width),this.height&&t.push("height="+this.height),t.join(", ")}}class i{constructor(t,e){console.log(`Constructing Gesturesdetector for window ${t}`),this.window=t,this.listener=e,document.addEventListener("click",(t=>{console.log("onClick"),this.onClick(t)}),!1)}onClick(t){if(t.defaultPrevented)return;const e=this.window.getSelection();if(e&&"Range"==e.type)return;let i;i=t.target instanceof HTMLElement?this.nearestInteractiveElement(t.target):null,i?i instanceof HTMLAnchorElement&&this.listener.onLinkActivated(i.href):(console.log("tap detected"),this.listener.onTap(t)),t.stopPropagation(),t.preventDefault()}nearestInteractiveElement(t){return null==t?null:-1!=["a","audio","button","canvas","details","input","label","option","select","submit","textarea","video"].indexOf(t.nodeName.toLowerCase())||t.hasAttribute("contenteditable")&&"false"!=t.getAttribute("contenteditable").toLowerCase()?t:t.parentElement?this.nearestInteractiveElement(t.parentElement):null}}class s{constructor(e,s,n,o){this.fit="contain",this.insets={top:0,right:0,bottom:0,left:0},this.scale=1,new i(e,{onTap:t=>{var i,s,a;console.log(`metaViewport ${n.content}`);const h=e.document.documentElement;console.log(`docElement ${h.scrollLeft} ${h.scrollTop}`),console.log(`scale ${null===(i=e.visualViewport)||void 0===i?void 0:i.scale}`),console.log(`visualviewport ${null===(s=e.visualViewport)||void 0===s?void 0:s.width} ${null===(a=e.visualViewport)||void 0===a?void 0:a.height}`);const l={x:t.clientX*this.scale/(e.visualViewport.scale*this.scale),y:t.clientY*this.scale/(e.visualViewport.scale*this.scale)};o.onTap(l)},onLinkActivated:t=>{throw Error("No interactive element in the root document.")}}),this.metaViewport=n;const a={onIframeLoaded:()=>{this.onIframeLoaded()},onTap:t=>{var i,n,a;const h=e.document.documentElement;console.log(`docElement ${h.scrollLeft} ${h.scrollTop}`),console.log(`scale ${null===(i=e.visualViewport)||void 0===i?void 0:i.scale}`),console.log(`visualviewport ${null===(n=e.visualViewport)||void 0===n?void 0:n.width} ${null===(a=e.visualViewport)||void 0===a?void 0:a.height}`);const l=s.getBoundingClientRect();console.log(`boundingRect $} ${l.left} ${l.top}`);const r={x:(t.x+l.left)*this.scale/(e.visualViewport.scale*this.scale),y:(t.y+l.top)*this.scale/(e.visualViewport.scale*this.scale)};o.onTap(r)},onLinkActivated:t=>{o.onLinkActivated(t)}};this.page=new t(e,s,a)}setViewport(t,e){this.viewport==t&&this.insets==e||(this.viewport=t,this.insets=e,this.layout())}setFit(t){this.fit!=t&&(this.fit=t,this.layout())}loadResource(t){this.page.hide(),this.page.loadPage(t)}onIframeLoaded(){this.page.size&&this.layout()}layout(){if(!this.page.size||!this.viewport)return;const t={top:this.insets.top,right:this.insets.right,bottom:this.insets.bottom,left:this.insets.left};this.page.setMargins(t);const i={width:this.viewport.width-this.insets.left-this.insets.right,height:this.viewport.height-this.insets.top-this.insets.bottom},s=function(t,e,i){switch(t){case"contain":return function(t,e){const i=e.width/t.width,s=e.height/t.height;return Math.min(i,s)}(e,i);case"width":return function(t,e){return e.width/t.width}(e,i);case"height":return function(t,e){return e.height/t.height}(e,i)}}(this.fit,this.page.size,i);this.metaViewport.content=(new e).setInitialScale(s).setMinimumScale(s).setWidth(this.page.size.width).setHeight(this.page.size.height).build(),this.scale=s,this.page.show()}}class n{constructor(t){this.nativeApi=t}onTap(t){this.nativeApi.onTap(JSON.stringify(t))}onLinkActivated(t){this.nativeApi.onLinkActivated(t)}}const o=document.getElementById("page"),a=document.querySelector("meta[name=viewport]");window.singleArea=new class{constructor(t,e,i,o){const a=new n(o);this.manager=new s(t,e,i,a)}loadResource(t){this.manager.loadResource(t)}setViewport(t,e,i,s,n,o){const a={width:t,height:e},h={top:i,left:o,bottom:n,right:s};this.manager.setViewport(a,h)}setFit(t){if("contain"!=t&&"width"!=t&&"height"!=t)throw Error(`Invalid fit value: ${t}`);this.manager.setFit(t)}}(window,o,a,window.gestures)}();
//# sourceMappingURL=fixed-single-script.js.map